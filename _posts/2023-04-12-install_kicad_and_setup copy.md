---
layout:       post
title:        키보드 만들기 두 번째 - Kicad 설치하고, 외부 라이브러리 적용하기
categories:   [custom keyboard]
tags:         [제작기]
description:  '커스텀 키보드 만들기 두 번째 시간. Kicad를 설치하고 환경 설정을 해 봅시다.'
---

글이 늦었습니다. 글을 어떻게 쓸까 고민만 하다가 시간이 이렇게 흘렀네요. 앞으로는 짧은 글이라도 자주자주 써 보도록 하겠습니다.

이번 포스트부터는 저번에 예고했던 대로 Kicad를 이용하여 pcb를 그리는 방법을 적어보려고 합니다. 이 부분이 가장 중요하고, DIY 키보드 제작에 있어 반 이상을 차지하는 중요한 부분입니다. 나머지는 하우징인데, 사실 아크릴 하우징에서는 크게 디자인이 먹는 부분이 많지 않아서, 제 마음대로(?) pcb가 더 중요하다고 생각하기로 했습니다.

이 포스트를 작성하는 지금, 저번 포스트까지 작성한 레이아웃으로 키보드를 이미 만들었습니다. 그런데 좀 실사하면서 부족한 부분이 몇 가지 발견되어, v2(?) 를 다시 제작해 보기로 했습니다. 그래서 v2를 제작하는 과정을 포스팅하게 되겠네요.

서론이 길었네요. 일단 Kicad를 컴퓨터에 설치해 봅시다. [Kicad 다운로드 페이지](https://www.kicad.org/download/)를 들어가서, download를 해 봅시다.

![Kicad 다운로드 페이지](https://user-images.githubusercontent.com/38902150/231388851-f105533c-c2b8-481a-93f0-1e9cebbfaec6.png)

활성화된 링크가 많은데, os에 맞는 것을 골라서 받아줍니다. 저는 windows, github에서 다운로드하였습니다. 다운로드가 완료되면, 이어서 설치를 해 줍니다. 저는 딱히 설치 과정에서 건드린 건 없습니다. 그냥 기본 그대로 설치하였습니다. 끝나고 나오는 Freecad 관련 체크박스가 있을텐데, 뭐 프리캐드를 사용할 거면 체크하라고 하는 내용 같네요. 저는 다른 캐드를 사용할 거라, 체크해 주지 않고 완료합니다.

자, 설치가 되면 실행해 봅시다!

![Kicad 실행 화면](https://user-images.githubusercontent.com/38902150/231390513-00568043-3768-4dad-a9fe-e2def731c239.png)

첫 실행화면입니다. 뭐 한 게 없으니 아무것도 없는게 당연하죠. 이제 우리가 만들 pcb 프로젝트를 생성해 봅시다. 컨트롤 + n을 누르거나, 파일 - 새 프로젝트를 눌러 프로젝트 생성 창을 엽니다. 적당한 곳에 프로젝트 명을 입력해 줍니다. 저는 제 키보드의 이름을 Pherk60으로 하기로 정했으니까, Pherk60이라는 이름으로 프로젝트를 만들었습니다.

![Kicad 프로젝트 생성 완료](https://user-images.githubusercontent.com/38902150/231391447-ce6533f5-c28c-48bf-bec2-c3baeb4d4247.png)

자, 프로젝트 밑에 두 개의 파일이 생성된 것을 확인할 수 있습니다. 우리는 먼저 sch 파일에서 심볼을 이용해 논리 회로도를 그리고, pcb 파일에서 논리 회로도의 각 부품에 해당하는 풋프린트를 배치한 다음, 마지막으로 배선을 연결하여 pcb 디자인을 완성할 것입니다. 이게 뭔 말인가 싶을 겁니다. 저도 뭔 말인가 싶었으니까요. 괜찮습니다. 하면서 알게 됩니다.

이제 바로 그리기를 시작할까요? 아직 아닙니다. Kicad에는 없는 심볼 라이브러리와 풋프린트 라이브러리를 추가해 주어야 합니다. 심볼과 풋프린트는 이렇게 알고 계시면 될 것 같습니다.

>심볼 : 논리 회로도를 그릴 때 사용되는 기호. sch 파일에서 사용합니다.  
풋프린트 : PCB 부품 배치를 할 때 사용되는 부품. pcb 파일에서 사용합니다.  
라이브러리 : 각 부품의 모음. 심볼 라이브러리는 심볼의 모음이라고 생각하시면 됩니다.

Kicad 자체적으로도 많은 수의 심볼/풋프린트 라이브러리가 있지만(심지어 키보드용 풋프린트도 있습니다!), 저희는 조금 더 편리한 디자인을 위해 외부 라이브러리를 추가할 겁니다. 

저는 스위치를 직접 pcb에 납땜하지 않고, 핫스왑이 가능한 형태로 pcb를 만들 겁니다. 그래서 체리MX 스위치 용으로 나온 카일 핫스왑 소켓 풋프린트가 필요합니다.

스위치 스캐닝 방식은 시프트 레지스터를 사용할 겁니다. 기존의 매트릭스 방식을 사용하면 mcu의 핀아웃을 최소 15개는 사용해야 합니다. 시프트 레지스터 방식을 사용하면 gnd/vcc 제외 핀아웃을 3개만 사용하면 됩니다. 그래서 작은 mcu도 사용할 수 있는데요. 대표적으로 Seeeduino Xiao rp2040이 있겠네요. mcu는 이걸 사용하기로 합니다. 그래서 rp2040의 심볼과 풋프린트가 필요합니다. 단, 풋프린트의 경우에는 pcb에 rp2040을 바로 납땜하지 않고 핀헤더로 연결할 겁니다. 그래서 rp2040의 규격에 맞는 핀헤더 홀이 필요하네요. 이걸 풋프린트로 만들도록 합시다.

정리하면 이렇게 되네요.

1. [체리MX 스위치용 카일 핫스왑 소켓 풋프린트](https://github.com/ai03-2725/MX_V2)
2. [Xiao RP2040 mcu 심볼](https://wiki.seeedstudio.com/XIAO-RP2040#resources)
3. [Xiao RP2040 mcu 납땜용 핀헤더 홀 풋프린트](https://github.com/sky2park/RP2040_footprint)

1번과 3번은 깃헙 저장소입니다. 초록색 '<> Code' 버튼을 누른 다음 Download ZIP 하시면 됩니다. 깃헙을 잘 아시는 분은 굳이 방법을 알려드리지 않아도 알아서 잘 하실 거라 생각합니다.
2번은 공식 문서입니다. Resource 탭에서 Seeed Studio XIAO RP2040 KiCAD file을 받으시면 됩니다.

모두 받았으면 압축을 푼 다음, 1번에서 MX_Hotswap.pretty 폴더, 2번에서 MOUDLE-SEEEDUINO-XIAO.kicad_sym 파일, 3번의 RP2040_pinheader 폴더을 아까 만든 Kicad 프로젝트 폴더 안에 넣어줍니다. 별도 라이브러리 폴더를 만들어서 넣어도 되고, 그냥 프로젝트 파일이 있는 폴더에 바로 넣어 주셔도 됩니다.

이제 Kicad 프로젝트를 다시 엽니다. 아까 프로젝트 화면에서 설정 - 심볼 라이브러리 관리로 들어갑니다. 새 창이 열릴 텐데, '프로젝트별 라이브러리' 탭을 누릅니다. 하단 폴더 버튼을 누른 다음, 아까 프로젝트 폴더 안으로 넣은 MOUDLE-SEEEDUINO-XIAO.kicad_sym 파일을 찾아 확인을 누릅니다. 라이브러리가 추가된게 확인되면 확인 버튼을 누릅니다.

다음으로 설정 - 풋프린트 라이브러리 관리로 들어갑니다.여기서는 파일을 추가하는 것이 아니라, 폴더를 추가합니다. 똑같이 프로젝트별 라이브러리 탭을 누르고, 폴더 버튼을 누른 다음, MX_Hotswap.pretty 폴더와 RP2040_pinheader 폴더를 선택하여 추가해 줍니다.

![심볼 라이브러리](https://user-images.githubusercontent.com/38902150/231409796-49ca399f-cced-41aa-90e7-69a6c820d7af.png)
![풋프린트 라이브러리](https://user-images.githubusercontent.com/38902150/231409886-b3410599-c5ad-4cbb-850f-803851967fe6.png)


이렇게 세개의 라이브러리 추가가 끝났습니다. 이제 pcb를 만들 준비는 끝난거라고 보시면 됩니다. 다음에는 정말로! 논리 회로도를 그리는 내용을 포스팅하겠습니다.